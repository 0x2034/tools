<<<<>>>>
Android
<<<<>>>>

* adb connect 192.168.1.127:5555
  adb shell

* Configuring The Proxy :
    
    adb shell settings put global http_proxy 192.168.1.16:9999
    adb shell settings put global https_proxy 192.168.1.16:9999

* Apps are installed in /data/data

* For Frida scripts 
  
  https://github.com/0xdea/frida-scripts
  https://github.com/TheBountyBox/Awesmoe-Frida-Scripts

* adb shell pm list packages -f 

* adb shell pm path <package_name>

* adb push <file> /data/

* adb install <>.apk

* adb uninstall <package_name>

* adb pull /data/app/<>.apk <>.apk

* Signing an APK : 
  
    apktool d <>.apk
    apktool b <>.apk
    Uber_apk_signer.jar -a <>.apk -o .   

* adb shell input text <>

---------------
Static Analysis
---------------

* Mobsf

* jadx-gui

* jadx <>.apk --log-level error
  
  dex2jar classes.dex
  jd-gui classes-dex2jar.jar

* androguard decompile <>.apk -o apk_folder

* CallGraph :
  
    androguard cg <>.apk -o <>.gml
    gephi

* FlowGraph :
  
    androguard decompile -i <>.apk -f png --limit '^Loversecured/ovaa/' -o <>_fg
    gimp 

----------------
Dynamic Analysis
----------------

* Drozer
    
    run app.package.list -f allsafe
    run app.package.attacksurface infosecadventures.allsafe
    
    run app.activity.info -a infosecadventures.allsafe
    run app.activity.start --component infosecadventures.allsafe infosecadventures.allsafe.MainActivity
  
    run app.provider.info -a infosecadventures.allsafe
    run scanner.provider.finduris -a infosecadventures.allsafe
    run app.provider.query content://infosecadventures.allsafe.dataprovider/
    run scanner.provider.injection -a infosecadventures.allsafe
    run scanner.provider.traversal -a content://infosecadventures.allsafe.dataprovider/
    run app.provider.read content://infosecadventures.allsafe.fileprovider/etc/hosts
    
    run app.broadcast.info -a infosecadventures.allsafe
    run app.broadcast.send --component infosecadventures.allsafe infosecadventures.allsafe.challenges.NoteReceiver --extra string server "192.168.1.16" --extra string note "testing" --extra string notification_message "hacked"
    
    run app.service.info -a infosecadventures.allsafe
    run app.service.send infosecadventures.allsafe infosecadventures.allsafe.challenges.RecorderService --msg 1 1 1 
    (Sieve apk Ex.) run app.service.send com.withsecure.example.sieve com.withsecure.example.sieve.service.AuthService --msg 2354 9234 1111 --extra string com.withsecure.example.sieve.service.AuthService.PIN "1234" --bundle-as-obj
  
* Objection 
    
    sudo objection --gadget infosecadventures.allsafe explore
    env
    android shell_exec id
    android hooking get current_activity

    memory list modules
    memory list exports libsync.so

    android hooking list activities
    android hooking list services
    android hooking list receivers
 
    android hooking search classes infosecadventures.allsafe
    android hooking search methods infosecadventures.allsafe.MainActivity
    android hooking list class_methods infosecadventures.allsafe.MainActivity
 
    android hooking watch class infosecadventures.allsafe.MainActivity --dump-args --dump-return
    android hooking watch class_method infosecadventures.allsafe.MainActivity.onSupportNavigateUp --dump-args --dump-return

    android hooking set return_value infosecadventures.allsafe.challenges.PinBypass.checkPin true
    
* Frida

    frida-ps -Uai
    frida -U -p 5329
    frida -U -f infosecadventures.allsafe
    frida -U -l hook.js -f infosecadventures.allsafe

* Activity Manager and ADB 
    
   adb shell am start-activity -n com.android.insecurebankv2/com.android.insecurebankv2.PostLogin
  
   adb shell am startservice infosecadventures.allsafe/infosecadventures.allsafe.challenges.RecorderService
   adb shell dumpsys activity services
 
   adb shell am broadcast com.apphacking.broadcastreceiver/com.apphacking.broadcastreceiver.SaveData
   adb shell am broadcast -a android.intent.action.BATTERY_LOW
   adb shell am broadcast -a  com.apphacking.broadcastreceiver.alarmState --es "status" "arm"
   adb shell am broadcast -n infosecadventures.allsafe/infosecadventures.allsafe.challenges.NoteReceiver -a infosecadventures.allsafe.action.PROCESS_NOTE --es "server"  "prod.allsafe.infosecadventures.io" --es "notification_message" "hello"
    
   adb shell content query --uri content://com.android.insecurebankv2.TrackUserContentProvider/trackerusers/
   adb shell content delete --uri content://com.android.insecurebankv2.TrackUserContentProvider/trackerusers/ --where "id=4"
   adb shell content insert --uri content://com.android.insecurebankv2.TrackUserContentProvider/trackerusers --bind name:s:omar
   adb shell content update --uri content://com.android.insecurebankv2.TrackUserContentProvider/trackerusers/ --bind id:i:4 --where id=7

--------------
Vulnerabilites
--------------

* Insecure logging

  adb shell ps
  adb logcat | grep <pid>
  to detect this vulnerability in the code we search for log | log.d | log.e keywords

* Insecure data storage

- via shared preferences
  /data/data/<package name>
  to detect this vulnerability in the code we search for SharedPreferences keyword

- via database
  /data/data/<package name>
  to detect this vulnerability in the code we search for insert into keyword

- via tempfiles
  /data/data/<package name>
  to detect this vulnerability in the code we search for createtempfile keyword

- via external storage
  /sdcard
  to detect this vulnerability in the code we search for getExternalStorage keyword

* Firebase Misconfiguration

  https://<>/.json

* Deep link

  to detect this vulnerability in the manifest.xml we search for data keyword
  adb shell am start -n infosecadventures.allsafe/infosecadventures.allsafe.challenges.DeepLinkTask -d "allsafe://infosecadventures/congrats?key=ebfb7ff0-b2f6-41c8-bef3-4fba17be410c

* Task hijacking (Works on androids less than 10 (API level 29)

  to detect this vulnerability in the manifest.xml we search for android:taskAffinity not empty or not exists also android:launchMode="singleTask"

  Exploitation  :
    From AndroidManifest.xml add android:taskAffinity="<packagename of the target>" and android:launchMode="singleTask" also android:excludeFromRecents="true"
    From MainActivity.Kt in onCrete method => moveTaskToBack(true)

* WebView

  adb shell am start-activity -n  com.tmh.vulnwebview/com.tmh.vulnwebview.SupportWebView --es "support_url" "file:///etc/hosts"

* SSL-Pinning And ROOT-Detection Bypass

- Flutter apps :
  reflutter o.apk

- Objection :
  objection patchapk -s o.apk
  objection --gadget com.o.s explore
  android sslpinning disable
  android root disable

- Proxydroid

- Medusa
  Python3 medusa.py
  Search ssl or root
  use <ssl. or root.>
  compile
  run -f <>

- android-unpinner
  android-unpinner all allsafe.apk

============================================================================================

<<>>
IOS
<<>>

* ssh root@<ip> and the password : alpine

* For Frida scripts 
  
  https://github.com/0xdea/frida-scripts
  https://github.com/TheBountyBox/Awesmoe-Frida-Scripts

* Usefull Tweaks 
  
  Safeshutdown
  Substitute 
  Sslkillswitch 

* Respring from ssh if the iphone hangs
  
  killall -9 SpringBoard
 
* To extract .ipa move it to .zip then unzip .zip
 
* To install .ipa we use sideloadly 
 
* Apps Bundles are installed in /var/containers/Bundle/Application/<UUID>/<AppName>.app

* Apps Containers (Sandbox) in /var/mobile/Containers/Data/Application/<UUID>/

* Important Apps from Cydia 
  
  MTerminal
  Filza 

* To move files via scp or rsync

- From remote to local :
  scp root@192.168.1.33:/var/mobile/Media/sunblet.ipa .
  scp -r  omar@192.168.1.32:/Users/omar/Documents/sunblet  sunblet
  rsync -avz --progress -e ssh omar@192.168.1.32:/Users/omar/Documents/sunblet.ipa .
 
- From local to remote :
  scp sunblet.ipa omar@192.168.1.32:/Users/omar/Documents/
  scp -r sunblet omar@192.168.1.32:/Users/omar/Documents/
  rsync -avz --progress sunblet.ipa omar@192.168.1.32:/Users/omar/Documents/
 
* Extracting IPAs 
  
  With Frida-ios-dump using USB From Mac 
  Iproxy 2222 22
  ./dump.py <App_name> or <bundle_identifier>
    Or
  Using AnyTrans app

---------------
Static Analysis
---------------

* Mobsf

* Hopper Disassembler , Radare2 & Ghidra for Reversing .ipa 
 
----------------
Dynamic Analysis
----------------

* Frida

- frida-ps -Ua
  frida -U -p 23207 
  frida -UF => if the app is running in front 

- frida -UF -l raptor_frida_ios_enum.js
  enumAllClasses()
  findClasses("Login")
  enumAllMethods()
  enumMethods("ECardsAndKeys.LocalLoginViewController")
  findMethods("Login")

* Objection
  
  - With Combination of Frida to get Classes with Login word => findClasses("Login") 
  ios hooking list class_methods LoginValidate
  ios hooking watch LoginValidate
  ios hooking watch "+[LoginValidate isLoginValidated]" --dump-args --dump-return
  ios hooking set return_value "+[LoginValidate isLoginValidated]" true


--------------
Vulnerabilites
--------------

* Insecure Data Storage

  find . -name "*.sqlite" -o -name "*.db" in the App Container

  - Plist => /var/mobile/Containers/Data/Application/<7AC17D78-BCD7-4397-A124-871FAA92031E>/Documents

  - UserDefaults => via Objection ios nsuserdefaults get

  - Keychain => via Objection ios keychain dump

  - Core Data => /var/mobile/Containers/Data/Application/<7AC17D78-BCD7-4397-A124-871FAA92031E>/Library/Application Support/<Model>.sqlite

  - Realm => /var/mobile/Containers/Data/Application/<7AC17D78-BCD7-4397-A124-871FAA92031E>/Documents/default.realm

  - Couchbase Lite => /var/mobile/Containers/Data/Application/<7AC17D78-BCD7-4397-A124-871FAA92031E>/Library/Application Support/CouchbaseLite/<dvcouchbasedb.cblite2>

  - Yapdatabase => /var/mobile/Containers/Data/Application/<7AC17D78-BCD7-4397-A124-871FAA92031E>/Library/Application Support/< YapDatabase.sqlite>

* SSL-Pinning And Jailbreak-Detection Bypass

  Via Objection ios jailbreak disable
  Sslkillswitch Tweak => SSL Pinning bypass

* Application Log Analysis (Insecure Logging)

  idevicesyslog | grep <word>

* Firebase Misconfiguration

  https://<>/.json

* UIPasteboard and Cookies

  Via Objection ios pasteboard monitor
  Via Objection ios cookies get

* Deeplink from the iphone shell

  uiopen "eck://trainingapp.com/webpage?url=https://www.google.com"

* Sensitive data leak via App Memory

  Python3 fridump.py -U -s DVIA-v2

* Touch/Face ID bypass

  via Objection ios ui biometrics_bypass

